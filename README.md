
# Render API

Цей проект представляє собою простий API, розгорнутий на платформі Render з використанням Flask та SQLAlchemy для взаємодії з базою даних. Всі необхідні залежності автоматично встановлюються при розгортанні додатку на Render.

## Кроки для розгортання:

**Налаштування середовища:**

   Створіть файл `.env` для збереження ваших змінних оточення, наприклад:
   ```
   DATABASE_URL=your-database-url
   ```

   Тут `DATABASE_URL` — це URL вашої бази даних, який ви отримали під час налаштування на платформі (наприклад, від Railway).

 **Розгортання на Render:**

   - Увійдіть в свій обліковий запис на платформі [Render](https://render.com/).
   - Створіть новий web-сервіс.
   - Підключіть цей репозиторій до Render.
   - Встановіть Python як середовище виконання.
   - Налаштуйте команду запуску як `python app.py`.
   - Платформа Render автоматично підготує середовище, встановить всі залежності, використовуючи `requirements.txt`, і запустить ваше API.

## Ось докладніше про кожен крок для розгортання API на платформі Render: ##

#### Крок 1: Увійдіть в свій обліковий запис на Render

1. Перейдіть на [Render](https://render.com/) і увійдіть або створіть новий обліковий запис, якщо у вас його немає.

#### Крок 2: Створіть новий web-сервіс

1. Після входу в систему натискайте кнопку **New** в верхньому правому куті.
2. Виберіть **Web Service**.
3. На наступному екрані вам буде запропоновано підключити ваш репозиторій. Виберіть **GitHub** або **GitLab** (залежно від того, де зберігається ваш код).
4. Дозвольте Render доступ до вашого облікового запису GitHub або GitLab, якщо ще не підключили ці сервіси.

#### Крок 3: Підключіть цей репозиторій до Render

1. Після авторизації виберіть репозиторій, який ви хочете розгорнути. Це може бути той самий репозиторій, в якому міститься ваш код.
2. Оберіть потрібну гілку (звичайно це `main` або `master`), якщо потрібно.

#### Крок 4: Встановіть Python як середовище виконання

1. Після того як ви підключите репозиторій, вам потрібно налаштувати середовище для виконання вашого додатку.
2. В полі **Environment** виберіть **Python**.
3. В поле **Python Version** оберіть версію Python, яка вам підходить (рекомендується використовувати версію, яка вказана в `runtime.txt`, якщо така є в проєкті).
   
   **Примітка:** Render автоматично виявить залежності, якщо у вас є файл `requirements.txt` в репозиторії.

#### Крок 5: Налаштуйте команду запуску як `python app.py`

1. В полі **Build Command** вкажіть команду для побудови середовища, якщо вона потрібна (наприклад, якщо ви використовуєте Docker або інші інструменти).
   
   Для простого Python проєкту команда для побудови не потрібна, оскільки Render автоматично встановить залежності з `requirements.txt`.
   
2. В полі **Start Command** вкажіть команду для запуску додатку:
   ```
   python app.py
   ```
   Це вказує Render, що потрібно запускати Flask додаток за допомогою Python.

#### Крок 6: Налаштуйте змінні оточення

1. Відкрийте вкладку **Environment Variables**.
2. Додайте всі необхідні змінні оточення, такі як:
   - `DATABASE_URL` (URL до вашої бази даних, якщо ви використовуєте базу даних).
  
  ***Додайте необхідні змінні:***
   - Для `DATABASE_URL`:
     - **Key**: `DATABASE_URL`
     - **Value**: `URL до вашої бази даних, якщо ви використовуєте базу даних`
   
 Якщо ви використовуєте файл `.env`, переконайтеся, що Render може отримати ці змінні з вашого репозиторію або додайте їх вручну.

#### Крок 7: Платформа Render автоматично підготує середовище

1. Після того, як ви налаштуєте все, натискайте **Create Web Service**.
2. Render автоматично підготує середовище для запуску вашого додатку:
   - Він автоматично прочитає файл `requirements.txt` і встановить всі залежності (Flask, SQLAlchemy тощо).
   - Якщо в проекті є файл `.env`, Render використає ці налаштування для змінних оточення.

#### Крок 8: Запуск вашого API

1. Після того, як середовище підготовлено, Render автоматично запустить ваш додаток.
2. Ви отримаєте URL вашого API (наприклад, `https://your-app-name.onrender.com`), за яким можна буде звертатися до вашого сервісу.

Render надає інтерфейс для моніторингу вашого сервісу, де ви можете перевірити логи, переглядати статус додатку та запускати повторні розгортання, якщо потрібно.

### Тестування API

1. Як тільки ваше API запуститься на Render, ви можете тестувати його, використовуючи запити через cURL або PowerShell, як зазначено в попередніх кроках.

2. Ви зможете використовувати URL, наданий Render, для доступу до вашого API та перевірки роботи розгорнутого сервісу.

1. **Тестування API через cURL:**

   Після того як ваш API буде розгорнуто на Render, ви зможете тестувати його через cURL. Приклад запиту для тестування:

   ```bash
   curl 'https://render-api-4bxz.onrender.com/api/v1/productentitiestool-ui-admin/partner/getAll' \
     -X 'POST' \
     -H 'sec-ch-ua: "Chromium";v="128", "Not;A=Brand";v="24", "Google Chrome";v="128"' \
     -H 'pragma: no-cache' \
     -H 'z-currency: USD' \
     -H 'sec-ch-ua-mobile: ?0' \
     -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36' \
     -H 'content-type: application/json' \
     -H 'cache-control: no-cache' \
     -H 'Referer: https://admin.spaceship.net/' \
     -H 'z-lang: en-US' \
     -H 'sec-ch-ua-platform: "macOS"'
   ```

   У відповідь ви повинні отримати дані:
   ```json
   [{"id":1,"name":"Partner 1"},{"id":2,"name":"Partner 2"}]
   ```

2. **Тестування через PowerShell:**

   Ви також можете тестувати API за допомогою PowerShell. Для цього виконайте наступний запит:

   ```powershell
   Invoke-WebRequest -Uri "https://render-api-4bxz.onrender.com/api/v1/productentitiestool-ui-admin/partner/getAll" `
     -Method Get `
     -Headers @{
         "sec-ch-ua" = 'Chromium;v="128", "Not;A=Brand";v="24", "Google Chrome";v="128"'
         "pragma" = "no-cache"
         "z-currency" = "USD"
         "sec-ch-ua-mobile" = "?0"
         "User-Agent" = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
         "content-type" = "application/json"
         "cache-control" = "no-cache"
         "Referer" = "https://admin.spaceship.net/"
         "z-lang" = "en-US"
         "sec-ch-ua-platform" = "macOS"
     }
   ```

   Якщо все налаштовано правильно, ви отримаєте відповідь:

   ```
   StatusCode        : 200
   StatusDescription : OK
   Content           : [{"id":1,"name":"Partner 1"},{"id":2,"name":"Partner 2"}]
   RawContentLength  : 58
   ```

3. **Перевірка результатів:**

   Переконайтесь, що ви отримали коректну відповідь від API, яка повинна містити список партнерів:
   ```json
   [{"id":1,"name":"Partner 1"},{"id":2,"name":"Partner 2"}]
   ```

## Налаштування додатку:

- `app.py`: основний файл додатку, який містить точку входу.
- `config.py`: конфігураційний файл для налаштувань бази даних.
- `models.py`: моделі SQLAlchemy для роботи з базою даних.
- `tests/test_app.py`: файл з тестами для перевірки правильності роботи API.

## Залежності:

Усі залежності зберігаються в `requirements.txt`, включаючи Flask, SQLAlchemy та бібліотеку для роботи з .env файлами:
```bash
Flask
psycopg2
SQLAlchemy
python-dotenv
```